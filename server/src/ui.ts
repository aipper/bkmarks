export function html() {
  return `<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Bkmarks</title><link rel="stylesheet" href="/static/app.css"></head><body><div id="app"><header class="topbar"><div class="brand">Bkmarks</div><input id="search" class="search" placeholder="搜索书签"><div id="user" class="user"></div></header><main><div id="tags" class="tags"></div><div id="content"><div id="register" class="panel hidden"><h2>注册</h2><input id="ru" placeholder="用户名"><input id="rp" type="password" placeholder="密码"><button id="registerBtn">注册</button></div><div id="login" class="panel hidden"><h2>登录</h2><input id="u" placeholder="用户名"><input id="p" type="password" placeholder="密码"><button id="loginBtn">登录</button></div><div id="list" class="grid"></div></div></main></div><script src="/static/app.js"></script></body></html>`
}

export function css() {
  return `:root{--bg:#f7f7f8;--card:#ffffff;--text:#1c1c1e;--muted:#6e6e73;--primary:#007aff;--border:#e5e5ea;--shadow:0 8px 24px rgba(0,0,0,0.08)}*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif}header.topbar{display:flex;align-items:center;gap:12px;padding:12px 16px;background:var(--card);border-bottom:1px solid var(--border)}.brand{font-weight:600;font-size:18px}.search{flex:1;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#fafafa}.search:focus{outline:2px solid rgba(0,122,255,0.3)}.user{min-width:120px;text-align:right;color:var(--muted)}main{padding:16px}.tags{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px}.pill{padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:#fafafa;color:#333;cursor:pointer}.pill.active{background:var(--primary);border-color:var(--primary);color:#fff}.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}.card{position:relative;background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px;display:flex;flex-direction:column;gap:6px;box-shadow:var(--shadow)}.status-dot{position:absolute;right:10px;top:10px;width:8px;height:8px;border-radius:50%}.status-ok{background:#34c759}.status-bad{background:#ff3b30}.title{font-weight:600}.url{font-size:12px;color:var(--muted);overflow:hidden;text-overflow:ellipsis}.panel{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:20px;max-width:380px;box-shadow:var(--shadow)}.panel h2{margin:0 0 12px 0;font-size:20px;font-weight:700}.panel input{width:100%;margin:8px 0;padding:12px;border:1px solid var(--border);border-radius:12px;background:#fafafa}.panel input:focus{outline:2px solid rgba(0,122,255,0.3)}.panel button{width:100%;margin-top:12px;padding:12px 16px;border:none;border-radius:12px;background:var(--primary);color:#fff;font-weight:600}.hidden{display:none}body.login main{min-height:calc(100vh - 56px);display:flex;align-items:center;justify-content:center}body.login #tags,body.login #list{display:none}`
}

export function js() {
  return `(function(){const qs=(s)=>document.querySelector(s);const elTags=qs('#tags');const elList=qs('#list');const elSearch=qs('#search');const elUser=qs('#user');const elRegister=qs('#register');const elLogin=qs('#login');const elRU=qs('#ru');const elRP=qs('#rp');const elRegisterBtn=qs('#registerBtn');const elU=qs('#u');const elP=qs('#p');const elLoginBtn=qs('#loginBtn');let items=[];let activeTag='全部';function renderTags(){const tags=new Map();tags.set('全部',items.length);for(const it of items){(it.tags||[]).forEach(t=>tags.set(t,(tags.get(t)||0)+1))}const arr=Array.from(tags.entries()).sort((a,b)=>b[1]-a[1]);elTags.innerHTML='';arr.forEach(([t,c])=>{const d=document.createElement('button');d.className='pill'+(t===activeTag?' active':'');d.textContent=t;d.onclick=()=>{activeTag=t;renderList()};elTags.appendChild(d)})}function renderList(){const q=(elSearch.value||'').toLowerCase();const filtered=items.filter(it=>{const inTag=activeTag==='全部'||(it.tags||[]).includes(activeTag);const str=(it.title||'')+' '+(it.url||'');const inSearch=str.toLowerCase().includes(q);return inTag&&inSearch});elList.innerHTML='';filtered.forEach(it=>{const a=document.createElement('a');a.className='card';a.href=it.url;a.target='_blank';const dot=document.createElement('div');dot.className='status-dot '+((it.status==='ok')?'status-ok':'status-bad');const t=document.createElement('div');t.className='title';t.textContent=it.title||it.url;const u=document.createElement('div');u.className='url';u.textContent=it.url;const tg=document.createElement('div');tg.className='url';tg.textContent=(it.tags||[]).slice(0,3).join(' · ');a.appendChild(dot);a.appendChild(t);a.appendChild(u);a.appendChild(tg);elList.appendChild(a)})}function showLogin(){elLogin.classList.remove('hidden');elRegister.classList.add('hidden')}function showRegister(){elRegister.classList.remove('hidden');elLogin.classList.add('hidden')}async function fetchRegistration(){const r=await fetch('/api/auth/registration');if(r.status===200){const j=await r.json();if(j.open){showRegister();return true}}showLogin();return false}async function fetchMe(){const r=await fetch('/api/auth/me');if(r.status===200){const j=await r.json();elUser.textContent=j.user.username;document.body.classList.remove('login');elLogin.classList.add('hidden');elRegister.classList.add('hidden');return true}else{elUser.textContent='未登录';document.body.classList.add('login');await fetchRegistration();return false}}async function fetchItems(){const r=await fetch('/api/bookmarks/list');if(r.status!==200){items=[];renderTags();renderList();return}const j=await r.json();items=j.items||[];renderTags();renderList()}async function runCheck(){await fetch('/api/links/check?limit=20',{method:'POST'});await fetchItems()}elSearch.addEventListener('input',renderList);elRegisterBtn.addEventListener('click',async()=>{const username=elRU.value.trim();const password=elRP.value;if(!username||!password)return;const r=await fetch('/api/auth/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})});if(r.status===200){showLogin()}});elLoginBtn.addEventListener('click',async()=>{const username=elU.value.trim();const password=elP.value;if(!username||!password)return;const r=await fetch('/api/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})});if(r.status===200){elLogin.classList.add('hidden');elRegister.classList.add('hidden');document.body.classList.remove('login');fetchMe().then(()=>{fetchItems();runCheck()})}});fetchMe().then(()=>{fetchItems();runCheck()})})();`
}
